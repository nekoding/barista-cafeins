// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  output          = "barista-client"
  previewFeatures = ["postgresqlExtensions"]
  binaryTargets   = ["native", "linux-musl-openssl-3.0.x", "rhel-openssl-1.1.x"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_BARISTA_URL")
  extensions = [postgis]
}

enum MIGRATION_STATUS {
  CREATED
  UPDATED
}

// Model
model Project {
  uuid                 String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cafeins_uuid         String?           @db.Uuid
  company_code         String
  vendor_no            String
  name                 String
  project_group_code   String            @unique
  created_at           DateTime          @default(now())
  updated_at           DateTime          @updatedAt
  created_employee_no  String
  modified_employee_no String?
  description          String?
  po_number            String?
  owner_name           String
  owner_nik            String
  status               MIGRATION_STATUS?
  last_read            DateTime?
  is_migrated          Boolean           @default(false)
  assets               Asset[]
  Cable                Cable[]           @relation("cable_project")
  Segment              Segment[]         @relation("segment_project")

  @@map("projects")
}

model SitePoint {
  uuid                 String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cafeins_uuid         String?                  @db.Uuid
  name                 String
  company_code         String
  site_group_code      String                   @unique
  latitude             Float
  longitude            Float
  geometry             Unsupported("geometry")?
  created_at           DateTime                 @default(now())
  updated_at           DateTime                 @updatedAt
  created_employee_no  String
  modified_employee_no String?
  status               MIGRATION_STATUS?
  last_read            DateTime?
  is_migrated          Boolean                  @default(false)
  assets               Asset[]
  RouteFrom            Route[]                  @relation("route_sitepoint_from")
  RouteTo              Route[]                  @relation("route_sitepoint_to")
  CableFrom            Cable[]                  @relation("cable_sitepoint_from")
  CableTo              Cable[]                  @relation("cable_sitepoint_to")
  SegmentFrom          Segment[]                @relation("segment_sitepoint_from")
  SegmentTo            Segment[]                @relation("segment_sitepoint_to")

  @@map("site_points")
}

model Log {
  uuid       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  level      String
  message    String
  meta       Json?
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?

  @@map("logs")
}

model Asset {
  uuid                 String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cafeins_uuid         String?           @db.Uuid
  unique_id            String            @unique
  name                 String
  description          String?
  created_at           DateTime          @default(now())
  updated_at           DateTime          @updatedAt
  created_employee_no  String
  modified_employee_no String?
  code                 String
  asset_group_code     String
  project_group_code   String
  site_group_code      String
  asset_category       String
  asset_ownership      String
  area_ownership       String
  status               MIGRATION_STATUS?
  last_read            DateTime?
  is_migrated          Boolean           @default(false)

  project   Project   @relation(fields: [project_group_code], references: [project_group_code])
  sitepoint SitePoint @relation(fields: [site_group_code], references: [site_group_code])

  @@map("assets")
}

model Route {
  uuid                 String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cafeins_uuid         String?                  @db.Uuid
  unique_id            String                   @unique
  name                 String
  geometry             Unsupported("geometry")?
  length               Decimal?                 @db.Decimal(10, 3)
  created_at           DateTime                 @default(now())
  updated_at           DateTime                 @updatedAt
  created_employee_no  String
  modified_employee_no String?
  site_group_code_from String
  site_group_code_to   String
  route_method         String
  route_ownership      String
  status               MIGRATION_STATUS?
  last_read            DateTime?
  is_migrated          Boolean                  @default(false)
  sitepoint_from       SitePoint                @relation(fields: [site_group_code_from], references: [site_group_code], name: "route_sitepoint_from")
  sitepoint_to         SitePoint                @relation(fields: [site_group_code_to], references: [site_group_code], name: "route_sitepoint_to")

  @@map("routes")
}

model Cable {
  uuid                      String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cafeins_uuid              String?           @db.Uuid
  unique_id                 String            @unique
  project_group_code        String
  name                      String
  description               String?
  length                    Decimal           @db.Decimal(10, 3)
  created_at                DateTime          @default(now())
  updated_at                DateTime          @updatedAt
  created_employee_no       String
  modified_employee_no      String?
  cable_category            String
  cable_group               String
  site_group_code_from      String
  site_group_code_to        String
  asset_ownership           String
  area_ownership            String
  placement_type            String
  function                  String
  route_unique_id_pembentuk String?
  status                    MIGRATION_STATUS?
  last_read                 DateTime?
  is_migrated               Boolean           @default(false)
  sitepoint_from            SitePoint         @relation(fields: [site_group_code_from], references: [site_group_code], name: "cable_sitepoint_from")
  sitepoint_to              SitePoint         @relation(fields: [site_group_code_to], references: [site_group_code], name: "cable_sitepoint_to")
  project                   Project           @relation(fields: [project_group_code], references: [project_group_code], name: "cable_project")

  @@map("cables")
}

model Segment {
  uuid                      String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cafeins_uuid              String?           @db.Uuid
  unique_id                 String            @unique
  project_group_code        String
  name                      String
  created_at                DateTime          @default(now())
  updated_at                DateTime          @updatedAt
  created_employee_no       String
  modified_employee_no      String?
  site_group_code_from      String
  site_group_code_to        String
  route_unique_id_pembentuk String?
  status                    MIGRATION_STATUS?
  last_read                 DateTime?
  is_migrated               Boolean           @default(false)
  sitepoint_from            SitePoint         @relation(fields: [site_group_code_from], references: [site_group_code], name: "segment_sitepoint_from")
  sitepoint_to              SitePoint         @relation(fields: [site_group_code_to], references: [site_group_code], name: "segment_sitepoint_to")
  project                   Project           @relation(fields: [project_group_code], references: [project_group_code], name: "segment_project")

  @@map("segments")
}
